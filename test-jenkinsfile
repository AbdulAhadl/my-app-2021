pipeline{

agent any

environment{
   PATH = "/opt/test-maven:$PATH"
}
stages{
    stage('git checkout'){
        steps{
             git 'https://github.com/AbdulAhadl/my-app-2021.git'
        }
    
    }
    stage('build the src'){
        steps{
            sh 'mvn clean package'
            sh 'mv target/*.war target/myweb.war'
        }
    
    }
    stage('deploy to tomcate'){
        steps{
        sshagent(['newtest-jenkins']) {
           sh """
              scp ssh -o StrictHostKeyChecking=no target/myweb  root@ip-172-31-36-221/apache-tomcat-9.0.71/webapps/ 
              ssh root@ip-172-31-36-221  /apache-tomcat-9.0.71/bin/shutdown.sh
              ssh root@ip-172-31-36-221  /apache-tomcat-9.0.71/bin/startup.sh
              
              """
             
             }
            }
        }
    
    }

}
